From 5e47c2985fa616f5ec30ad05a70384c6360a361c Mon Sep 17 00:00:00 2001
From: danielh <danielh@138bc75d-0d04-0410-961f-82ee72b054a4>
Date: Mon, 10 Nov 2014 11:35:27 +0000
Subject: [PATCH 344/366] 2014-11-10  Daniel Hellstrom  <daniel@gaisler.com>

	Backport from mainline
	* config.gcc (sparc-*-rtems*): Clean away unused t-elf.
	* config/sparc/t-rtems: Add leon3v7 and muser-mode multilibs.


git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/branches/gcc-4_8-branch@217283 138bc75d-0d04-0410-961f-82ee72b054a4
---
 gcc/ChangeLog            |  6 ++++++
 gcc/config.gcc           |  2 +-
 gcc/config/sparc/t-rtems | 13 +++++++++++--
 3 files changed, 18 insertions(+), 3 deletions(-)

diff --git a/gcc/ChangeLog b/gcc/ChangeLog
index 8bc6fc8..99bba83 100644
--- a/gcc/ChangeLog
+++ b/gcc/ChangeLog
@@ -1,3 +1,9 @@
+2014-11-10  Daniel Hellstrom  <daniel@gaisler.com>
+
+	Backport from mainline
+	* config.gcc (sparc-*-rtems*): Clean away unused t-elf.
+	* config/sparc/t-rtems: Add leon3v7 and muser-mode multilibs.
+
 2014-11-07  Daniel Hellstrom  <daniel@gaisler.com>
 
 	* config.gcc (sparc*-*-*): Accept mcpu=leon3v7 processor.
diff --git a/gcc/config.gcc b/gcc/config.gcc
index 2491f10..57a415b 100644
--- a/gcc/config.gcc
+++ b/gcc/config.gcc
@@ -2466,7 +2466,7 @@ sparc-*-elf*)
 	;;
 sparc-*-rtems*)
 	tm_file="${tm_file} dbxelf.h elfos.h sparc/sysv4.h sparc/sp-elf.h sparc/rtemself.h rtems.h newlib-stdint.h"
-	tmake_file="sparc/t-sparc sparc/t-elf sparc/t-rtems t-rtems"
+	tmake_file="sparc/t-sparc sparc/t-rtems t-rtems"
 	;;
 sparc-*-linux*)
 	tm_file="${tm_file} dbxelf.h elfos.h sparc/sysv4.h gnu-user.h linux.h glibc-stdint.h sparc/tso.h"
diff --git a/gcc/config/sparc/t-rtems b/gcc/config/sparc/t-rtems
index f1a3d84..5b4d414 100644
--- a/gcc/config/sparc/t-rtems
+++ b/gcc/config/sparc/t-rtems
@@ -17,6 +17,15 @@
 # <http://www.gnu.org/licenses/>.
 #
 
-MULTILIB_OPTIONS = msoft-float mcpu=v8/mcpu=leon3
-MULTILIB_DIRNAMES = soft v8 leon3
+MULTILIB_OPTIONS = msoft-float mcpu=v8/mcpu=leon3/mcpu=leon3v7 muser-mode
+MULTILIB_DIRNAMES = soft v8 leon3 leon3v7 user-mode
 MULTILIB_MATCHES = msoft-float=mno-fpu
+
+MULTILIB_EXCEPTIONS = muser-mode
+MULTILIB_EXCEPTIONS += mcpu=leon3
+MULTILIB_EXCEPTIONS += mcpu=leon3v7
+MULTILIB_EXCEPTIONS += msoft-float/mcpu=leon3
+MULTILIB_EXCEPTIONS += msoft-float/mcpu=leon3v7
+MULTILIB_EXCEPTIONS += msoft-float/muser-mode
+MULTILIB_EXCEPTIONS += msoft-float/mcpu=v8/muser-mode
+MULTILIB_EXCEPTIONS += mcpu=v8/muser-mode
-- 
2.0.3

